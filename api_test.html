<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; box-sizing: border-box; }
        button { padding: 10px 15px; background: #2196F3; color: white; border: none; cursor: pointer; }
        pre { background: #f0f0f0; padding: 15px; overflow: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Тест API поиска тендеров</h1>
        
        <div class="form-group">
            <label for="queryInput">Поисковый запрос:</label>
            <input type="text" id="queryInput" value="Тендеры по медицине">
        </div>
        
        <div class="form-group">
            <label for="regionSelect">Выберите регион:</label>
            <select id="regionSelect">
                <option value="">Выберите регион...</option>
                <option value="77">77 - Москва</option>
                <option value="78">78 - Санкт-Петербург</option>
                <option value="50">50 - Московская область</option>
                <option value="52">52 - Нижегородская область</option>
                <option value="61">61 - Ростовская область</option>
                <option value="23">23 - Краснодарский край</option>
                <option value="66">66 - Свердловская область</option>
                <!-- Можно добавить больше регионов или загружать их динамически -->
            </select>
        </div>
        
        <button onclick="testAPI()">Проверить API</button>
        
        <h2>Результат запроса:</h2>
        <pre id="result" style="background:#f0f0f0; padding:10px; margin-top:20px;"></pre>
    </div>

    <script>
        // Функция для удаления кавычек из строки запроса
        function sanitizeQuery(str) {
            return str.replace(/['"\\]/g, '');
        }
        
        async function testAPI() {
            const rawQuery = document.getElementById('queryInput').value;
            // Очищаем запрос от кавычек
            const query = sanitizeQuery(rawQuery);
            
            // Получаем выбранный регион
            const regionSelect = document.getElementById('regionSelect');
            const regionCode = regionSelect.value;
            
            const apiUrl = 'http://localhost:8001';
            const resultEl = document.getElementById('result');
            
            resultEl.textContent = 'Отправка запроса...';
            
            try {
                // Формируем тело запроса
                const requestBody = {
                    query: query,
                    top_k: 5
                };
                
                // Добавляем регион, если он выбран
                if (regionCode) {
                    requestBody.region = regionCode;
                }
                
                console.log('Отправляем запрос:', requestBody);
                resultEl.textContent = `Отправка запроса: ${JSON.stringify(requestBody, null, 2)}`;
                
                const response = await fetch(`${apiUrl}/search-tenders/`, {
                    method: 'POST',
                    headers: {
                        'accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                resultEl.textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                resultEl.textContent = 'Ошибка: ' + error.message;
            }
        }
    </script>
</body>
</html> 